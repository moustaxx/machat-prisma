# Migration `20201019191242-testing`

This migration has been generated by moustaxx <maciasm1303@gmail.com> at 10/19/2020, 9:12:42 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "test_1603134759912_c68c1435ce8e6"."conversation" (
"created_at" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
"name" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "test_1603134759912_c68c1435ce8e6"."message" (
"content" text   NOT NULL ,
"author_id" integer   ,
"conversation_id" integer   NOT NULL ,
"created_at" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" SERIAL,
PRIMARY KEY ("id")
)

CREATE TABLE "test_1603134759912_c68c1435ce8e6"."person" (
"created_at" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"email" text   NOT NULL ,
"id" SERIAL,
"is_active" boolean   NOT NULL DEFAULT true,
"is_admin" boolean   ,
"last_seen" timestamp(3)   ,
"username" text   NOT NULL ,
"hash" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "test_1603134759912_c68c1435ce8e6"."session" (
"sid" text   NOT NULL ,
"sess" jsonb   NOT NULL ,
"expire" timestamp(3)   NOT NULL ,
PRIMARY KEY ("sid")
)

CREATE TABLE "test_1603134759912_c68c1435ce8e6"."_ConversationToPerson" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "person.email_unique" ON "test_1603134759912_c68c1435ce8e6"."person"("email")

CREATE UNIQUE INDEX "person.username_unique" ON "test_1603134759912_c68c1435ce8e6"."person"("username")

CREATE UNIQUE INDEX "_ConversationToPerson_AB_unique" ON "test_1603134759912_c68c1435ce8e6"."_ConversationToPerson"("A", "B")

CREATE INDEX "_ConversationToPerson_B_index" ON "test_1603134759912_c68c1435ce8e6"."_ConversationToPerson"("B")

ALTER TABLE "test_1603134759912_c68c1435ce8e6"."message" ADD FOREIGN KEY ("author_id")REFERENCES "test_1603134759912_c68c1435ce8e6"."person"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "test_1603134759912_c68c1435ce8e6"."message" ADD FOREIGN KEY ("conversation_id")REFERENCES "test_1603134759912_c68c1435ce8e6"."conversation"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "test_1603134759912_c68c1435ce8e6"."_ConversationToPerson" ADD FOREIGN KEY ("A")REFERENCES "test_1603134759912_c68c1435ce8e6"."conversation"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "test_1603134759912_c68c1435ce8e6"."_ConversationToPerson" ADD FOREIGN KEY ("B")REFERENCES "test_1603134759912_c68c1435ce8e6"."person"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200816210553-testing..20201019191242-testing
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Conversation {
   createdAt    DateTime  @default(now()) @map("created_at")
@@ -37,9 +37,8 @@
   isAdmin       Boolean?       @map("is_admin")
   lastSeen      DateTime?      @map("last_seen")
   username      String         @unique
   hash          String
-  salt          String
   messages      Message[]
   conversations Conversation[] @relation("ConversationToPerson", references: [id])
   @@map(name: "person")
```


